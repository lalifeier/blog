"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[692],{9613:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(9496);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),i=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=i(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=i(n),u=l,m=d["".concat(s,".").concat(u)]||d[u]||h[u]||r;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=u;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[d]="string"==typeof e?e:l,o[1]=c;for(var i=2;i<r;i++)o[i]=n[i];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1264:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>c,toc:()=>i});var a=n(5882),l=(n(9496),n(9613));const r={},o="clash",c={unversionedId:"tool/clash",id:"tool/clash",title:"clash",description:"Systemd",source:"@site/docs/tool/clash.md",sourceDirName:"tool",slug:"/tool/clash",permalink:"/blog/tool/clash",draft:!1,editUrl:"https://github.com/lalifeier/blog/edit/main/docs/tool/clash.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u5de5\u5177",permalink:"/blog/category/tool"},next:{title:"Git \u591a\u7528\u6237\u914d\u7f6e\u7ba1\u7406\u5668",permalink:"/blog/tool/git-multi-user-configuration-manager"}},s={},i=[{value:"Systemd",id:"systemd",level:2},{value:"\u5b89\u88c5 clash",id:"\u5b89\u88c5-clash",level:3},{value:"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6",id:"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6",id:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762",id:"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762",level:3},{value:"\u5f00\u673a\u542f\u52a8",id:"\u5f00\u673a\u542f\u52a8",level:3},{value:"\u8bbe\u7f6e\u7cfb\u7edf\u4ee3\u7406",id:"\u8bbe\u7f6e\u7cfb\u7edf\u4ee3\u7406",level:3},{value:"\u914d\u7f6e\u5b9a\u65f6\u66f4\u65b0\u8ba2\u9605",id:"\u914d\u7f6e\u5b9a\u65f6\u66f4\u65b0\u8ba2\u9605",level:3},{value:"\u6bcf\u5468\u81ea\u52a8\u66f4\u65b0\u8ba2\u9605\u914d\u7f6e\u6587\u4ef6",id:"\u6bcf\u5468\u81ea\u52a8\u66f4\u65b0\u8ba2\u9605\u914d\u7f6e\u6587\u4ef6",level:4},{value:"Docker",id:"docker",level:2},{value:"docker-compose.yml",id:"docker-composeyml",level:3},{value:"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6",id:"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6-1",level:3},{value:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6",id:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6-1",level:3},{value:"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762",id:"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762-1",level:3}],p={toc:i};function d(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"clash"},"clash"),(0,l.kt)("h2",{id:"systemd"},"Systemd"),(0,l.kt)("h3",{id:"\u5b89\u88c5-clash"},"\u5b89\u88c5 clash"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"curl -L -O https://github.com/Dreamacro/clash/releases/download/v1.12.0/clash-linux-amd64-v1.12.0.gz\nsudo mv clash-linux-amd64-v1.12.0 /usr/local/bin/clash\nchmod +x /usr/local/bin/clash\n")),(0,l.kt)("h3",{id:"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6"},"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /etc/clash\ncd /etc/clash\n\n# Country.mmdb\nsudo wget https://github.com/Dreamacro/maxmind-geoip/releases/download/20230112/Country.mmdb\n# sudo wget https://cdn.jsdelivr.net/gh/baixf-xyz/baixf-xyz@latest/Country.mmdb\n# sudo wget https://www.sub-speeder.com/client-download/Country.mmdb\n\n# config.yaml\nsudo wget -O /etc/clash/config.yaml [\u4f60\u7684\u8ba2\u9605\u94fe\u63a5]\n\n# ui\n# clash-dashboard\n# sudo git clone -b gh-pages --depth 1 https://github.com/Dreamacro/clash-dashboard ui\n# yacd-dashboard\nsudo git clone -b gh-pages --depth 1 https://github.com/haishanh/yacd ui\n")),(0,l.kt)("h3",{id:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"# /etc/clash/config.yaml\nport: 7890\nsocks-port: 7891\nexternal-controller: :9090\nexternal-ui: /etc/clash/ui\n")),(0,l.kt)("h3",{id:"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762"},"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"http://localhost:9090/ui"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://clash.razord.top"},"http://clash.razord.top")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://yacd.haishan.me"},"http://yacd.haishan.me"))),(0,l.kt)("h3",{id:"\u5f00\u673a\u542f\u52a8"},"\u5f00\u673a\u542f\u52a8"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# /etc/systemd/system/clash.service\n[Unit]\nDescription=clash daemon\n\n[Service]\nType=simple\nUser=root\nExecStart=/usr/local/bin/clash -d /etc/clash/\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n\n# \u91cd\u8f7d systemctl daemon\nsystemctl daemon-reload\n")),(0,l.kt)("h3",{id:"\u8bbe\u7f6e\u7cfb\u7edf\u4ee3\u7406"},"\u8bbe\u7f6e\u7cfb\u7edf\u4ee3\u7406"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# \u8bbe\u7f6e\u7cfb\u7edf\u4ee3\u7406\n#/etc/profile.d/proxy.sh\n\nexport http_proxy="127.0.0.1:7890"\nexport https_proxy="127.0.0.1:7890"\nexport all_proxy="http://127.0.0.1:7890"\nexport no_proxy="localhost, 127.0.0.1"\n\n# \u91cd\u8f7d /etc/profile \u914d\u7f6e\nsource /etc/profile\n')),(0,l.kt)("h3",{id:"\u914d\u7f6e\u5b9a\u65f6\u66f4\u65b0\u8ba2\u9605"},"\u914d\u7f6e\u5b9a\u65f6\u66f4\u65b0\u8ba2\u9605"),(0,l.kt)("h4",{id:"\u6bcf\u5468\u81ea\u52a8\u66f4\u65b0\u8ba2\u9605\u914d\u7f6e\u6587\u4ef6"},"\u6bcf\u5468\u81ea\u52a8\u66f4\u65b0\u8ba2\u9605\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("p",null,"/etc/cron.weekly/clash.sh"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\nset -e\n\n# \u8ba2\u9605\u94fe\u63a5\u5730\u5740\nSUBSCRIBE=""\n# web-ui\u5b58\u653e\u76ee\u5f55\uff0c\u7559\u7a7a\u5219\u4fdd\u6301\u9ed8\u8ba4\u4e0d\u4fee\u6539\nWEB_UI=""\n# API \u7aef\u53e3\uff0c\u7559\u7a7a\u5219\u4fdd\u6301\u9ed8\u8ba4\u4e0d\u4fee\u6539\nCONTROLLER_API_PROT=""\n# API \u53e3\u4ee4\uff0c\u7559\u7a7a\u5219\u4fdd\u6301\u9ed8\u8ba4\u4e0d\u4fee\u6539\nSECRET=""\n\nCLASH_CONFIG="/etc/clash/config.yaml"\n\n\nif [ -z "${SUBSCRIBE}" ]; then\n    echo "Subscription address cannot be empty"\n    exit 1\nfi\n\nsystemctl stop clash\n\nwget --no-proxy -O ${CLASH_CONFIG} ${SUBSCRIBE}\n\nif [ -n "${WEB_UI}" ]; then\nsed -i "s?^#\\{0,1\\} \\{0,1\\}external-ui.*?external-ui: ${WEB_UI}?" ${CLASH_CONFIG}\nfi\n\nif [ -n "${CONTROLLER_API_PROT}" ]; then\nsed -i "s?^external-controller.*?external-controller: \'0.0.0.0:${CONTROLLER_API_PROT}\'?" ${CLASH_CONFIG}\nfi\n\nif [ -n "${SECRET}" ]; then\nsed -i "s?^secret.*?secret: \'${SECRET}\'?" ${CLASH_CONFIG}\nfi\n\nsystemctl start clash\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"chmod 0755 /etc/cron.weekly/clash.sh\n")),(0,l.kt)("h2",{id:"docker"},"Docker"),(0,l.kt)("h3",{id:"docker-composeyml"},"docker-compose.yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},'version: "3.7"\n\nnetworks:\n  app_net:\n    external: true\n\n# localhost:9090/ui\nservices:\n  clash:\n    image: dreamacro/clash:latest\n    container_name: clash\n    ports:\n      - 7890:7890\n      - 7891:7891\n      - 9090:9090 # external controller (Restful API)\n    networks:\n      - app_net\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - ./Country.mmdb:/root/.config/clash/Country.mmdb\n      - ./config.yaml:/root/.config/clash/config.yaml\n      - ./ui:/ui # dashboard volume\n    # # TUN\n    # cap_add:\n    #   - NET_ADMIN\n    # devices:\n    #   - /dev/net/tun\n')),(0,l.kt)("h3",{id:"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6-1"},"\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/sh\n\n# Country.mmdb\nwget https://github.com/Dreamacro/maxmind-geoip/releases/download/20230112/Country.mmdb\n\n# config.yaml\nsudo wget -O /etc/clash/config.yaml [\u4f60\u7684\u8ba2\u9605\u94fe\u63a5]\n\n# ui\n# clash-dashboard\n# git clone -b gh-pages --depth 1 https://github.com/Dreamacro/clash-dashboard ui\n# yacd-dashboard\ngit clone -b gh-pages --depth 1 https://github.com/haishanh/yacd ui\n")),(0,l.kt)("h3",{id:"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6-1"},"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"# config.yaml\nport: 7890\nsocks-port: 7891\nexternal-controller: :9090\nexternal-ui: /ui\n")),(0,l.kt)("h3",{id:"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762-1"},"\u8bbf\u95ee\u7ba1\u7406\u754c\u9762"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"http://localhost:9090/ui"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://clash.razord.top"},"http://clash.razord.top")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://yacd.haishan.me"},"http://yacd.haishan.me"))))}d.isMDXComponent=!0}}]);